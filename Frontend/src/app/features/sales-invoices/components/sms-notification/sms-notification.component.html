<!-- SMS Notification Dialog Template -->
<div class="sms-notification-dialog">
  <!-- Dialog Header -->
  <div class="dialog-header">
    <h2 mat-dialog-title>
      <mat-icon>sms</mat-icon>
      Send SMS Notification
    </h2>
    <button mat-icon-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Dialog Content -->
  <mat-dialog-content class="dialog-content">
    <form [formGroup]="smsForm" class="sms-form">
      <!-- Invoice Information -->
      <mat-card class="invoice-info-card">
        <mat-card-content>
          <div class="invoice-details">
            <div class="detail-item">
              <span class="label">Invoice:</span>
              <span class="value">{{ data.invoice.invoiceNumber }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Customer:</span>
              <span class="value">{{ data.invoice.customer?.name }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Amount:</span>
              <span class="value">{{ data.invoice.totals.grandTotal | currency:'PKR':'symbol':'1.2-2' }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Due Date:</span>
              <span class="value">{{ data.invoice.dueDate | date:'dd/MM/yyyy' }}</span>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- SMS Configuration -->
      <mat-tab-group class="sms-tabs">
        <!-- Compose Tab -->
        <mat-tab label="Compose">
          <div class="tab-content">
            <!-- Template Selection -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Message Template</mat-label>
              <mat-select formControlName="templateId">
                <mat-option *ngFor="let template of templates" [value]="template.id">
                  {{ template.name }}
                </mat-option>
              </mat-select>
            </mat-form-field>

            <!-- Phone Number -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Phone Number</mat-label>
              <input matInput 
                     formControlName="phoneNumber" 
                     placeholder="+92 300 1234567"
                     type="tel">
              <mat-icon matSuffix>phone</mat-icon>
              <mat-error *ngIf="smsForm.get('phoneNumber')?.hasError('required')">
                Phone number is required
              </mat-error>
              <mat-error *ngIf="smsForm.get('phoneNumber')?.hasError('pattern')">
                Please enter a valid phone number
              </mat-error>
            </mat-form-field>

            <!-- Message Content -->
            <mat-form-field appearance="outline" class="full-width message-field">
              <mat-label>Message</mat-label>
              <textarea matInput 
                        formControlName="message"
                        rows="6"
                        placeholder="Enter your message here..."></textarea>
              <mat-hint align="end">
                {{ characterCount }}/{{ maxCharacters * estimatedParts }} characters 
                ({{ estimatedParts }} SMS{{ estimatedParts > 1 ? ' parts' : '' }})
              </mat-hint>
              <mat-error *ngIf="smsForm.get('message')?.hasError('required')">
                Message is required
              </mat-error>
              <mat-error *ngIf="smsForm.get('message')?.hasError('maxlength')">
                Message is too long
              </mat-error>
            </mat-form-field>

            <!-- Variable Chips -->
            <div class="variables-section" *ngIf="getAvailableVariables().length > 0">
              <label class="variables-label">Available Variables:</label>
              <div class="variables-chips">
                <mat-chip *ngFor="let variable of getAvailableVariables()" 
                          (click)="insertVariable(variable)"
                          class="variable-chip">
                  {{variable}}
                </mat-chip>
              </div>
            </div>

            <!-- Options -->
            <div class="options-section">
              <mat-checkbox formControlName="sendImmediately">
                Send immediately
              </mat-checkbox>

              <mat-form-field *ngIf="!smsForm.get('sendImmediately')?.value" 
                              appearance="outline" 
                              class="schedule-field">
                <mat-label>Schedule Date & Time</mat-label>
                <input matInput 
                       [matDatepicker]="schedulePicker" 
                       formControlName="scheduleDateTime">
                <mat-datepicker-toggle matSuffix [for]="schedulePicker"></mat-datepicker-toggle>
                <mat-datepicker #schedulePicker></mat-datepicker>
              </mat-form-field>

              <mat-checkbox formControlName="includeInvoiceLink">
                Include invoice link
              </mat-checkbox>

              <mat-checkbox formControlName="saveAsTemplate">
                Save as template
              </mat-checkbox>

              <mat-form-field *ngIf="smsForm.get('saveAsTemplate')?.value" 
                              appearance="outline" 
                              class="template-name-field">
                <mat-label>Template Name</mat-label>
                <input matInput 
                       formControlName="templateName" 
                       placeholder="Enter template name">
                <mat-error *ngIf="smsForm.get('templateName')?.hasError('required')">
                  Template name is required
                </mat-error>
              </mat-form-field>
            </div>
          </div>
        </mat-tab>

        <!-- Preview Tab -->
        <mat-tab label="Preview">
          <div class="tab-content">
            <mat-card class="preview-card">
              <mat-card-header>
                <mat-card-title>Message Preview</mat-card-title>
                <mat-card-subtitle>How your message will appear to the recipient</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="message-preview">
                  <div class="phone-mockup">
                    <div class="phone-header">
                      <span class="sender">Indus Traders</span>
                      <span class="time">{{ 'now' | date:'HH:mm' }}</span>
                    </div>
                    <div class="message-bubble">
                      {{ getPreviewMessage() }}
                    </div>
                  </div>
                </div>
                
                <div class="preview-stats">
                  <div class="stat-item">
                    <span class="stat-label">Characters:</span>
                    <span class="stat-value">{{ characterCount }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">SMS Parts:</span>
                    <span class="stat-value">{{ estimatedParts }}</span>
                  </div>
                  <div class="stat-item">
                    <span class="stat-label">Estimated Cost:</span>
                    <span class="stat-value">PKR {{ (estimatedParts * 2).toFixed(2) }}</span>
                  </div>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>

        <!-- Delivery Status Tab -->
        <mat-tab label="Delivery Status">
          <div class="tab-content">
            <mat-card class="delivery-status-card">
              <mat-card-header>
                <mat-card-title>SMS Delivery Tracking</mat-card-title>
                <mat-card-subtitle>Track the delivery status of your SMS notifications</mat-card-subtitle>
              </mat-card-header>
              <mat-card-content>
                <div class="delivery-info">
                  <p>Delivery tracking will be available after sending the SMS.</p>
                  <p>You will receive real-time updates on:</p>
                  <ul>
                    <li>Message sent status</li>
                    <li>Delivery confirmation</li>
                    <li>Read receipts (if supported)</li>
                    <li>Failed delivery notifications</li>
                  </ul>
                </div>
              </mat-card-content>
            </mat-card>
          </div>
        </mat-tab>
      </mat-tab-group>
    </form>
  </mat-dialog-content>

  <!-- Dialog Actions -->
  <mat-dialog-actions class="dialog-actions">
    <button mat-stroked-button 
            (click)="close()" 
            [disabled]="isLoading">
      Cancel
    </button>
    
    <button mat-raised-button 
            color="primary" 
            (click)="sendSMS()" 
            [disabled]="smsForm.invalid || isLoading">
      <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
      <mat-icon *ngIf="!isLoading">send</mat-icon>
      {{ isLoading ? 'Sending...' : 'Send SMS' }}
    </button>
  </mat-dialog-actions>
</div>