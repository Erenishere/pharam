<div class="report-container">
  <div class="report-header">
    <div class="header-left">
      <button mat-icon-button class="back-btn" routerLink="/reports"><mat-icon>arrow_back</mat-icon></button>
      <h1>Warehouse Reports</h1>
    </div>
    <div class="header-actions">
      <button mat-stroked-button class="refresh-btn" (click)="loadReport()"><mat-icon>refresh</mat-icon> Refresh</button>
    </div>
  </div>

  @if (loading) {
    <div class="loading-container"><mat-spinner diameter="48"></mat-spinner><p>Loading warehouse data...</p></div>
  } @else {
    <div class="summary-cards">
      <div class="summary-card">
        <div class="icon-wrapper purple"><mat-icon>warehouse</mat-icon></div>
        <div class="card-content">
          <div class="label">Total Warehouses</div>
          <div class="value">{{ formatNumber(warehouseStock?.summary?.totalWarehouses) }}</div>
        </div>
      </div>
      <div class="summary-card">
        <div class="icon-wrapper info"><mat-icon>inventory</mat-icon></div>
        <div class="card-content">
          <div class="label">Total Stock</div>
          <div class="value">{{ formatNumber(warehouseStock?.summary?.totalStock) }}</div>
        </div>
      </div>
      <div class="summary-card">
        <div class="icon-wrapper success"><mat-icon>attach_money</mat-icon></div>
        <div class="card-content">
          <div class="label">Total Value</div>
          <div class="value">{{ formatCurrency(warehouseStock?.summary?.totalValue) }}</div>
        </div>
      </div>
    </div>

    <mat-tab-group [(selectedIndex)]="activeTab" class="report-tabs">
      <mat-tab label="Stock by Warehouse">
        <div class="data-card">
          <div class="card-header"><h2>Stock by Warehouse</h2></div>
          <div class="table-container">
            @if (warehouseStock?.byWarehouse?.length > 0) {
              <table>
                <thead><tr><th>Warehouse</th><th class="text-right">Items</th><th class="text-right">Total Stock</th><th class="text-right">Value</th></tr></thead>
                <tbody>
                  @for (row of warehouseStock.byWarehouse; track row.warehouse?._id) {
                    <tr>
                      <td>{{ row.warehouse?.name || 'Unknown' }}</td>
                      <td class="text-right">{{ formatNumber(row.itemCount) }}</td>
                      <td class="text-right">{{ formatNumber(row.totalStock) }}</td>
                      <td class="text-right amount">{{ formatCurrency(row.value) }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            } @else {
              <div class="empty-state"><mat-icon>inbox</mat-icon><p>No warehouse data available</p></div>
            }
          </div>
        </div>
      </mat-tab>

      <mat-tab label="Stock Movements">
        <div class="data-card">
          <div class="card-header"><h2>Recent Stock Movements</h2></div>
          <div class="table-container">
            @if (warehouseStock?.stockMovements?.length > 0) {
              <table>
                <thead><tr><th>Date</th><th>Item</th><th>From</th><th>To</th><th class="text-right">Quantity</th><th>Type</th></tr></thead>
                <tbody>
                  @for (row of warehouseStock.stockMovements; track row._id) {
                    <tr>
                      <td>{{ row.date | date:'mediumDate' }}</td>
                      <td>{{ row.item?.name || 'Unknown' }}</td>
                      <td>{{ row.fromWarehouse?.name || '-' }}</td>
                      <td>{{ row.toWarehouse?.name || '-' }}</td>
                      <td class="text-right">{{ formatNumber(row.quantity) }}</td>
                      <td>{{ row.type }}</td>
                    </tr>
                  }
                </tbody>
              </table>
            } @else {
              <div class="empty-state"><mat-icon>inbox</mat-icon><p>No stock movements available</p></div>
            }
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  }
</div>
